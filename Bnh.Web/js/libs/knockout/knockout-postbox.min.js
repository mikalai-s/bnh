!(function(factory){if(typeof require==="function"&&typeof exports==="object"&&typeof module==="object"){factory(require("knockout"),exports);}else if(typeof define==="function"&&define.amd){define(["knockout","exports"],factory);}else{factory(ko,ko.postbox={});}}(function(ko,exports,undefined){var disposeTopicSubscription,existingSubscribe;ko.subscribable.call(exports);exports.topicCache={};exports.publish=function(topic,value){if(topic){exports.topicCache[topic]={value:value,serialized:ko.toJSON(value)};exports.notifySubscribers(value,topic);}};existingSubscribe=exports.subscribe;exports.subscribe=function(topic,action,target){if(topic){return existingSubscribe.call(exports,action,target,topic);}};exports.defaultComparer=function(newValue,cacheItem){return newValue===cacheItem.value&&ko.toJSON(newValue)===cacheItem.serialized;};ko.subscribable.fn.publishOn=function(topic,skipInitialOrEqualityComparer,equalityComparer){var skipInitialPublish;if(topic){if(typeof skipInitialOrEqualityComparer==="function"){equalityComparer=skipInitialOrEqualityComparer;}else{skipInitialPublish=skipInitialOrEqualityComparer;}
equalityComparer=equalityComparer||exports.defaultComparer;disposeTopicSubscription.call(this,topic,"publishOn");this.postboxSubs[topic].publishOn=this.subscribe(function(newValue){if(!equalityComparer.call(this,newValue,exports.topicCache[topic])){exports.publish(topic,newValue);}},this);if(!skipInitialPublish){exports.publish(topic,this());}}
return this;};disposeTopicSubscription=function(topic,type){var subs=this.postboxSubs=this.postboxSubs||{};subs[topic]=subs[topic]||{};if(subs[topic][type]){subs[topic][type].dispose();}};ko.subscribable.fn.stopPublishingOn=function(topic){disposeTopicSubscription.call(this,topic,"publishOn");return this;};ko.subscribable.fn.subscribeTo=function(topic,initializeWithLatestValueOrTransform,transform){var initializeWithLatestValue,current,callback,self=this;if(typeof initializeWithLatestValueOrTransform==="function"){transform=initializeWithLatestValueOrTransform;}else{initializeWithLatestValue=initializeWithLatestValueOrTransform;}
if(topic&&ko.isWriteableObservable(this)){disposeTopicSubscription.call(this,topic,"subscribeTo");callback=function(newValue){self(transform?transform.call(self,newValue):newValue);};this.postboxSubs[topic].subscribeTo=exports.subscribe(topic,callback);if(initializeWithLatestValue){current=exports.topicCache[topic];if(current!==undefined){callback(current.value);}}}
return this;};ko.subscribable.fn.unsubscribeFrom=function(topic){disposeTopicSubscription.call(this,topic,"subscribeTo");return this;};ko.subscribable.fn.syncWith=function(topic,initializeWithLatestValue,skipInitialOrEqualityComparer,equalityComparer){this.subscribeTo(topic,initializeWithLatestValue).publishOn(topic,skipInitialOrEqualityComparer,equalityComparer);return this;};}));